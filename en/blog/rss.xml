<?xml version="1.0" encoding="utf-8"?><?xml-stylesheet type="text/xsl" href="rss.xsl"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>KO HYEON LIM Blog</title>
        <link>https://indianapoly.github.io/en/blog</link>
        <description>KO HYEON LIM Blog</description>
        <lastBuildDate>Sun, 20 Jul 2025 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[Grafana + Prometheus + MySQL Exporter를 활용한 MySQL 모니터링 설정기]]></title>
            <link>https://indianapoly.github.io/en/blog/2025/07/20/docker/MYSQL-monioring-setting-title</link>
            <guid>https://indianapoly.github.io/en/blog/2025/07/20/docker/MYSQL-monioring-setting-title</guid>
            <pubDate>Sun, 20 Jul 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[{/ truncate /}]]></description>
            <content:encoded><![CDATA[
<p>최근에 인프라 관련된 수업을 진행하면서 내 스스로 할 수 있는 프로젝트가 뭔지, 어떻게 하면 오픈소스들을 잘 사용할 수 있을지 고민을 해보았습니다. 그 결과 DB를 만들고 DB에 데이터가 많이 몰리게 되었을 때 관리할 수 있는 흐름을 만들면 좋겠다 생각을 했습니다.</p>
<p>따라서 MySQL을 모니터링하기 위해 Prometheus와 Grafana를 연동해 대시보드를 구성하는 작업을 진행했습니다. 이 글에서는 그 전체 과정을 정리해봤어요.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="️-전체-아키텍처">🏗️ 전체 아키텍처<a href="https://indianapoly.github.io/en/blog/2025/07/20/docker/MYSQL-monioring-setting-title#%EF%B8%8F-%EC%A0%84%EC%B2%B4-%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98" class="hash-link" aria-label="Direct link to 🏗️ 전체 아키텍처" title="Direct link to 🏗️ 전체 아키텍처">​</a></h2>
<p>추후에 좀 더 복잡한 아키텍처도 만져보면서 계속해서 확장해나가보면 좋을거 같은 생각이듭니다!</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MySQL ← mysqld_exporter → Prometheus → Grafana</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ↑</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">phpMyAdmin (관리용)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-프로젝트-구조">📁 프로젝트 구조<a href="https://indianapoly.github.io/en/blog/2025/07/20/docker/MYSQL-monioring-setting-title#-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EA%B5%AC%EC%A1%B0" class="hash-link" aria-label="Direct link to 📁 프로젝트 구조" title="Direct link to 📁 프로젝트 구조">​</a></h2>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">grafana/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── provisioning/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── dashboards/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   └── dashboard.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── datasources/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       └── datasource.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── mysql/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── mysql_data/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── mysqld-exporter/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── my.cnf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── prometheus/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── prometheus.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── .env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── docker-compose.yml</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-docker-compose-설정">🐳 Docker Compose 설정<a href="https://indianapoly.github.io/en/blog/2025/07/20/docker/MYSQL-monioring-setting-title#-docker-compose-%EC%84%A4%EC%A0%95" class="hash-link" aria-label="Direct link to 🐳 Docker Compose 설정" title="Direct link to 🐳 Docker Compose 설정">​</a></h2>
<p>전체 스택을 한 번에 관리하기 위해 다음과 같이 docker-compose.yml을 구성했어요.</p>
<p>볼륨 설정시 파일 위치 실수를 방지하기 위해서 하나의 파일 내에서 관련된 파일들을 모두 관리해주었습니다.(이렇게 하니깐 확실히 상대경로로 관리하기 쉽다는 점이 좋았습니다.) 그리고 $<!-- -->로 표시한 내용에 대해서는 중요파일이기 때문에 .env로 파일을 설정해주었습니다. .env 파일에 대한 내용은 아래에 보면 확인할 수 있어요.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"3.8"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mysql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">MYSQL_ROOT_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">MYSQL_ROOT_PASSWORD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">MYSQL_DATABASE</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">MYSQL_DATABASE</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./mysql/mysql_data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/var/lib/mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"3306:3306"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">phpmyadmin</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> phpmyadmin/phpmyadmin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> phpmyadmin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">platform</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> linux/amd64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"8080:80"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">PMA_HOST</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">PMA_PORT</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3306</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mysqld-exporter</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prom/mysqld</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">exporter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mysqld_exporter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./mysqld</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">exporter/my.cnf</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/etc/mysql/my.cnf</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">ro</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"9104:9104"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"--config.my-cnf=/etc/mysql/my.cnf"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">prometheus</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prom/prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./prometheus/prometheus.yml</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/etc/prometheus/prometheus.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"9090:9090"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> mysqld</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">exporter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">grafana</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> grafana/grafana</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">container_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> grafana</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">GF_SECURITY_ADMIN_USER</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">GF_SECURITY_ADMIN_USER</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">GF_SECURITY_ADMIN_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">GF_SECURITY_ADMIN_PASSWORD</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./grafana/provisioning/dashboards</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/etc/grafana/provisioning/dashboards</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./grafana/provisioning/datasources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/etc/grafana/provisioning/datasources</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"3000:3000"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mysql_data</span><span class="token punctuation" style="color:#393A34">:</span><br></span></code></pre></div></div>
<p>.env 설정 파일이에요. MYSQL에서 root로 접근할 때 사용할 수 있는 password와 사용할 database를 지정을 해줍니다. Grafana와 같은 경우에는 비밀번호를 설정해주지 않으면 아이디와 비밀번호가 admin으로 설정이 되어있어요. 그리고 비밀번호를 변경하라는 메세지가 나오는데 docker 컨테이너를 내리고 다시 실행을 하게 되면 계속해서 비밀번호를 설정하라는 창이 나와서 설정해주는게 편했습니다.</p>
<div class="language-.env codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-.env codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MYSQL_ROOT_PASSWORD=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MYSQL_DATABASE=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GF_SECURITY_ADMIN_USER=</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GF_SECURITY_ADMIN_PASSWORD=</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-주요-설정-파일들">🔧 주요 설정 파일들<a href="https://indianapoly.github.io/en/blog/2025/07/20/docker/MYSQL-monioring-setting-title#-%EC%A3%BC%EC%9A%94-%EC%84%A4%EC%A0%95-%ED%8C%8C%EC%9D%BC%EB%93%A4" class="hash-link" aria-label="Direct link to 🔧 주요 설정 파일들" title="Direct link to 🔧 주요 설정 파일들">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-mysqld_exporter-설정-mycnf">1. mysqld_exporter 설정 (my.cnf)<a href="https://indianapoly.github.io/en/blog/2025/07/20/docker/MYSQL-monioring-setting-title#1-mysqld_exporter-%EC%84%A4%EC%A0%95-mycnf" class="hash-link" aria-label="Direct link to 1. mysqld_exporter 설정 (my.cnf)" title="Direct link to 1. mysqld_exporter 설정 (my.cnf)">​</a></h3>
<p>여기서 중요한 점은 user와 password는 내가 접근하고자하는 mysql의 내용이어야 돼요. 즉 user에 exporter가 설정이 되어 있지 않으면 access denied가 설정이 될 수 있어요. 이를 유의해서 작성해주어야 해요. 아래 내용에서 이와 관련된 문제 해결을 적어두었습니다.</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[client]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user=exporter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">password=exporter_password</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-prometheus-설정-prometheusyml">2. Prometheus 설정 (prometheus.yml)<a href="https://indianapoly.github.io/en/blog/2025/07/20/docker/MYSQL-monioring-setting-title#2-prometheus-%EC%84%A4%EC%A0%95-prometheusyml" class="hash-link" aria-label="Direct link to 2. Prometheus 설정 (prometheus.yml)" title="Direct link to 2. Prometheus 설정 (prometheus.yml)">​</a></h3>
<p>Prometheus가 타겟으로 하는 mysqld-expoert를 설정을 해주어야 합니다.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">global</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">scrape_interval</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 15s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">scrape_configs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">job_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"mysqld-exporter"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">static_configs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">targets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"mysqld-exporter:9104"</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-grafana-데이터소스-자동-설정-datasourceyml">3. Grafana 데이터소스 자동 설정 (datasource.yml)<a href="https://indianapoly.github.io/en/blog/2025/07/20/docker/MYSQL-monioring-setting-title#3-grafana-%EB%8D%B0%EC%9D%B4%ED%84%B0%EC%86%8C%EC%8A%A4-%EC%9E%90%EB%8F%99-%EC%84%A4%EC%A0%95-datasourceyml" class="hash-link" aria-label="Direct link to 3. Grafana 데이터소스 자동 설정 (datasource.yml)" title="Direct link to 3. Grafana 데이터소스 자동 설정 (datasource.yml)">​</a></h3>
<p>Grafana를 처음 실행을 하게 되면 data source를 정하는 과정이 있습니다. 이 과정을 하지 않으면 데이터를 가져오지 않기 때문에 당연히 대시보드가 정상적으로 만들어지지 않아요. 아래 파일을 설정을 해주면 Grafana가 실행할 때 자동으로 Prometheus를 설정해줍니다.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">datasources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">access</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//prometheus</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">9090</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">isDefault</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-주요-문제들과-해결책">🚨 주요 문제들과 해결책<a href="https://indianapoly.github.io/en/blog/2025/07/20/docker/MYSQL-monioring-setting-title#-%EC%A3%BC%EC%9A%94-%EB%AC%B8%EC%A0%9C%EB%93%A4%EA%B3%BC-%ED%95%B4%EA%B2%B0%EC%B1%85" class="hash-link" aria-label="Direct link to 🚨 주요 문제들과 해결책" title="Direct link to 🚨 주요 문제들과 해결책">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-mysqld_exporter-access-denied-문제-해결">1. mysqld_exporter <code>access denied</code> 문제 해결<a href="https://indianapoly.github.io/en/blog/2025/07/20/docker/MYSQL-monioring-setting-title#1-mysqld_exporter-access-denied-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0" class="hash-link" aria-label="Direct link to 1-mysqld_exporter-access-denied-문제-해결" title="Direct link to 1-mysqld_exporter-access-denied-문제-해결">​</a></h3>
<p><strong>문제</strong>: mysqld_exporter 실행 시 다음 오류 발생</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[ERROR] Access denied for user 'exporter'@'localhost'</span><br></span></code></pre></div></div>
<p><strong>해결책</strong>:</p>
<p>exporter가 접근할 user와 해당 user의 password를 my.cnf에 잘 설정 해주는 것이 중요합니다. my.cnf에 exporter를 설정을 해두었는데 mysql user에 exporter가 없다면 당연히 에러가 나요.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-grafana에서-prometheus-연결-실패">2. Grafana에서 Prometheus 연결 실패<a href="https://indianapoly.github.io/en/blog/2025/07/20/docker/MYSQL-monioring-setting-title#2-grafana%EC%97%90%EC%84%9C-prometheus-%EC%97%B0%EA%B2%B0-%EC%8B%A4%ED%8C%A8" class="hash-link" aria-label="Direct link to 2. Grafana에서 Prometheus 연결 실패" title="Direct link to 2. Grafana에서 Prometheus 연결 실패">​</a></h3>
<p><strong>문제</strong>: Grafana에서 <code>http://localhost:9090</code>으로 설정했더니 연결 실패</p>
<p><strong>해결책</strong>: 도커 컨테이너 환경에서는 서비스 이름으로 접근하는 것이 핵심이었습니다.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">❌ http://localhost:9090</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">✅ http://prometheus:9090</span><br></span></code></pre></div></div>
<p><strong>이유</strong>: 도커 컨테이너에서 <code>localhost</code>는 자기 자신(컨테이너 내부)을 의미하므로, 같은 네트워크 내의 다른 컨테이너에 접근할 때는 서비스명을 사용해야 합니다!</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-grafana-설정-자동화">3. Grafana 설정 자동화<a href="https://indianapoly.github.io/en/blog/2025/07/20/docker/MYSQL-monioring-setting-title#3-grafana-%EC%84%A4%EC%A0%95-%EC%9E%90%EB%8F%99%ED%99%94" class="hash-link" aria-label="Direct link to 3. Grafana 설정 자동화" title="Direct link to 3. Grafana 설정 자동화">​</a></h3>
<p>2번과 같이 수동 설정으로 설정하는 과정에 있어서 문제가 발생할 수도 있고, 컨테이너가 down 된 상태에서 다시 실행을 한다면 매번 해주는 과정이 귀찮아질 수 있어 data source를 자동화 해줄 수 있습니다.</p>
<p><code>provisioning</code> 디렉터리를 활용한 자동화 구현:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./grafana/provisioning/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── dashboards/     # 대시보드 자동 로딩</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── datasources/    # 데이터소스 자동 설정</span><br></span></code></pre></div></div>
<p>이렇게 하면 컨테이너 초기 실행 시 모든 설정이 자동으로 적용됨</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-phpmyadmin-추가로-관리-편의성-향상">4. phpMyAdmin 추가로 관리 편의성 향상<a href="https://indianapoly.github.io/en/blog/2025/07/20/docker/MYSQL-monioring-setting-title#4-phpmyadmin-%EC%B6%94%EA%B0%80%EB%A1%9C-%EA%B4%80%EB%A6%AC-%ED%8E%B8%EC%9D%98%EC%84%B1-%ED%96%A5%EC%83%81" class="hash-link" aria-label="Direct link to 4. phpMyAdmin 추가로 관리 편의성 향상" title="Direct link to 4. phpMyAdmin 추가로 관리 편의성 향상">​</a></h3>
<p>터미널 기반 MySQL 관리의 불편함을 해결하기 위해 phpMyAdmin 추가했어요.:</p>
<ul>
<li>포트: 8080 (보통 잘 사용하기 때문에 docker ps -a 를 활용해서 해당 포트를 잡고 있는 컨테이너가 있는지 확인해주어야 해요.)</li>
<li>시각적 테이블 관리</li>
<li>사용자 권한 설정 간편화</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-grafana-mysql-overview-dashboard-데이터-표시-문제">5. Grafana MySQL Overview Dashboard 데이터 표시 문제<a href="https://indianapoly.github.io/en/blog/2025/07/20/docker/MYSQL-monioring-setting-title#5-grafana-mysql-overview-dashboard-%EB%8D%B0%EC%9D%B4%ED%84%B0-%ED%91%9C%EC%8B%9C-%EB%AC%B8%EC%A0%9C" class="hash-link" aria-label="Direct link to 5. Grafana MySQL Overview Dashboard 데이터 표시 문제" title="Direct link to 5. Grafana MySQL Overview Dashboard 데이터 표시 문제">​</a></h3>
<p><strong>문제</strong>: 모든 패널이 <code>No data</code> 표시</p>
<p><strong>원인</strong>: 템플릿 변수와 쿼리 간 연동 문제가 있었어요.</p>
<ul>
<li><code>$host</code> 변수 설정 오류가 있어 prometheus로 부터 데이터를 가지고 오지 못해서 No data가 보였어요.</li>
</ul>
<p><strong>해결책</strong>:</p>
<ol>
<li>
<p><strong>$host 변수 재설정</strong>:</p>
<ul>
<li>Query type: <code>Label values</code></li>
<li>Metric: <code>mysql_global_status_threads_connected</code></li>
<li>Label: <code>instance</code></li>
</ul>
</li>
<li>
<p><strong>변수 새로고침 설정</strong>:</p>
<ul>
<li><code>On dashboard load</code>로 설정</li>
<li>또는 패널에서 수동 <code>Run query</code> 실행</li>
</ul>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-최종-구성-결과">📊 최종 구성 결과<a href="https://indianapoly.github.io/en/blog/2025/07/20/docker/MYSQL-monioring-setting-title#-%EC%B5%9C%EC%A2%85-%EA%B5%AC%EC%84%B1-%EA%B2%B0%EA%B3%BC" class="hash-link" aria-label="Direct link to 📊 최종 구성 결과" title="Direct link to 📊 최종 구성 결과">​</a></h2>
<p><a href="https://github.com/indianaPoly/mysql-monitoring" target="_blank" rel="noopener noreferrer">전체 코드 보러 갈래요</a></p>
<p>설정 완료 후 Grafana 대시보드에서 실시간으로 확인 가능한 지표들은 아래와 같아요:</p>
<ul>
<li><strong>MySQL Uptime</strong>: 서버 가동 시간</li>
<li><strong>Threads Connected/Running</strong>: 연결된 스레드 수</li>
<li><strong>QPS (Queries per Second)</strong>: 초당 쿼리 수</li>
<li><strong>InnoDB Buffer Pool</strong>: 버퍼 풀 사용량</li>
<li><strong>Connections</strong>: 연결 상태</li>
<li><strong>Table Locks</strong>: 테이블 잠금 현황</li>
<li><strong>Thread Cache</strong>: 스레드 캐시 상태</li>
</ul>
<p>대시보드 새로고침 간격을 <code>5초</code>로 설정하여 실시간에 가까운 모니터링 환경 구축할 수 있었습니다! 아래는 구성 후 결과물입니다.</p>
<img src="https://indianapoly.github.io/img/blog/docker/2025-07-20/img1.png" width="600">]]></content:encoded>
            <category>TIL</category>
            <category>Docker</category>
        </item>
        <item>
            <title><![CDATA[Terraform으로 EKS 배포 시 발생하는 리소스 충돌 해결 가이드]]></title>
            <link>https://indianapoly.github.io/en/blog/2025/07/19/terraform/terraform-errorHandling-title</link>
            <guid>https://indianapoly.github.io/en/blog/2025/07/19/terraform/terraform-errorHandling-title</guid>
            <pubDate>Sat, 19 Jul 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[{/ truncate /}]]></description>
            <content:encoded><![CDATA[
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-문제-상황">🚨 문제 상황<a href="https://indianapoly.github.io/en/blog/2025/07/19/terraform/terraform-errorHandling-title#-%EB%AC%B8%EC%A0%9C-%EC%83%81%ED%99%A9" class="hash-link" aria-label="Direct link to 🚨 문제 상황" title="Direct link to 🚨 문제 상황">​</a></h2>
<p>Terraform으로 EKS 클러스터를 배포하던 중 다음과 같은 오류들이 연속으로 발생했어요:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Error: creating EC2 EIP: operation error EC2: AllocateAddress,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">https response error StatusCode: 400, RequestID: &lt;requiest id&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">api error AddressLimitExceeded: The maximum number of addresses has been reached.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Error: creating KMS Alias (alias/eks/cwave): operation error KMS: CreateAlias,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">https response error StatusCode: 400, RequestID: &lt;requiest id&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AlreadyExistsException: An alias with the name arn:aws:kms:ap-northeast-2:368677659737:alias/eks/cwave already exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Error: creating EKS Cluster (cwave): operation error EKS: CreateCluster,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">https response error StatusCode: 409, RequestID: &lt;requiest id&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ResourceInUseException: Cluster already exists with name: cwave</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Error: creating IAM Role (efs-csi): operation error IAM: CreateRole,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">https response error StatusCode: 409, RequestID: &lt;requiest id&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EntityAlreadyExists: Role with name efs-csi already exists.</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-문제-원인-분석">🔍 문제 원인 분석<a href="https://indianapoly.github.io/en/blog/2025/07/19/terraform/terraform-errorHandling-title#-%EB%AC%B8%EC%A0%9C-%EC%9B%90%EC%9D%B8-%EB%B6%84%EC%84%9D" class="hash-link" aria-label="Direct link to 🔍 문제 원인 분석" title="Direct link to 🔍 문제 원인 분석">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="근본-원인-개발-환경-혼동으로-인한-리소스-중복">근본 원인: 개발 환경 혼동으로 인한 리소스 중복<a href="https://indianapoly.github.io/en/blog/2025/07/19/terraform/terraform-errorHandling-title#%EA%B7%BC%EB%B3%B8-%EC%9B%90%EC%9D%B8-%EA%B0%9C%EB%B0%9C-%ED%99%98%EA%B2%BD-%ED%98%BC%EB%8F%99%EC%9C%BC%EB%A1%9C-%EC%9D%B8%ED%95%9C-%EB%A6%AC%EC%86%8C%EC%8A%A4-%EC%A4%91%EB%B3%B5" class="hash-link" aria-label="Direct link to 근본 원인: 개발 환경 혼동으로 인한 리소스 중복" title="Direct link to 근본 원인: 개발 환경 혼동으로 인한 리소스 중복">​</a></h3>
<p><strong>실제 발생 과정:</strong></p>
<ol>
<li>개발 환경에 <code>local</code>과 <code>aws</code> 두 개의 폴더가 존재</li>
<li>지금까지 local 환경과 aws 환경을 착각해서 개발을 진행</li>
<li>local 환경에서 생성한 Terraform 리소스를 정확하게 삭제하지 않음</li>
<li>aws 폴더로 이동해서 다시 <code>terraform apply</code>를 시도</li>
<li><strong>결과</strong>: 동일한 리소스명으로 인한 중복 생성 시도로 충돌 발생했어요</li>
</ol>
<p><strong>폴더 구조 예시:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">project/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── local/          # 로컬 개발용 (기존 리소스 잔존)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── main.tf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── terraform.tfstate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── aws/            # AWS 환경용 (새로 배포 시도)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── main.tf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── terraform.tfstate</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="세부-원인들">세부 원인들<a href="https://indianapoly.github.io/en/blog/2025/07/19/terraform/terraform-errorHandling-title#%EC%84%B8%EB%B6%80-%EC%9B%90%EC%9D%B8%EB%93%A4" class="hash-link" aria-label="Direct link to 세부 원인들" title="Direct link to 세부 원인들">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-eip-한도-초과-문제">1. EIP 한도 초과 문제<a href="https://indianapoly.github.io/en/blog/2025/07/19/terraform/terraform-errorHandling-title#1-eip-%ED%95%9C%EB%8F%84-%EC%B4%88%EA%B3%BC-%EB%AC%B8%EC%A0%9C" class="hash-link" aria-label="Direct link to 1. EIP 한도 초과 문제" title="Direct link to 1. EIP 한도 초과 문제">​</a></h4>
<p>AWS 계정당 EIP(Elastic IP) 할당 한도가 있고 제가 확인했을 때는 5개가 할당 한도가 있었어요.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 현재 EIP 사용량 확인</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws ec2 describe-addresses --region ap-northeast-2</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-리소스-중복-문제">2. 리소스 중복 문제<a href="https://indianapoly.github.io/en/blog/2025/07/19/terraform/terraform-errorHandling-title#2-%EB%A6%AC%EC%86%8C%EC%8A%A4-%EC%A4%91%EB%B3%B5-%EB%AC%B8%EC%A0%9C" class="hash-link" aria-label="Direct link to 2. 리소스 중복 문제" title="Direct link to 2. 리소스 중복 문제">​</a></h4>
<p>EKS 클러스터를 삭제했지만 관련 리소스들(IAM 역할, KMS 별칭 등)은 자동으로 삭제되지 않았어요.</p>
<p><strong>왜 이런 일이 발생하는가?</strong></p>
<ul>
<li>EKS 클러스터 삭제 시 <strong>IAM 역할은 자동으로 삭제되지 않아요.</strong></li>
<li>KMS 별칭도 마찬가지로 수동 삭제가 필요해요.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-terraform-상태-파일-분리로-인한-문제">3. Terraform 상태 파일 분리로 인한 문제<a href="https://indianapoly.github.io/en/blog/2025/07/19/terraform/terraform-errorHandling-title#3-terraform-%EC%83%81%ED%83%9C-%ED%8C%8C%EC%9D%BC-%EB%B6%84%EB%A6%AC%EB%A1%9C-%EC%9D%B8%ED%95%9C-%EB%AC%B8%EC%A0%9C" class="hash-link" aria-label="Direct link to 3. Terraform 상태 파일 분리로 인한 문제" title="Direct link to 3. Terraform 상태 파일 분리로 인한 문제">​</a></h4>
<ul>
<li><code>local/terraform.tfstate</code>와 <code>aws/terraform.tfstate</code>가 각각 관리돼요.</li>
<li>실제 AWS 리소스는 동일하지만 Terraform 상태는 분리되어 있어요.</li>
<li>새로운 폴더에서 배포 시 기존 리소스를 인식하지 못하는 문제가 있는 것을 파악했어요.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="️-해결-과정">🛠️ 해결 과정<a href="https://indianapoly.github.io/en/blog/2025/07/19/terraform/terraform-errorHandling-title#%EF%B8%8F-%ED%95%B4%EA%B2%B0-%EA%B3%BC%EC%A0%95" class="hash-link" aria-label="Direct link to 🛠️ 해결 과정" title="Direct link to 🛠️ 해결 과정">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1단계-eip-사용량-확인-및-분석">1단계: EIP 사용량 확인 및 분석<a href="https://indianapoly.github.io/en/blog/2025/07/19/terraform/terraform-errorHandling-title#1%EB%8B%A8%EA%B3%84-eip-%EC%82%AC%EC%9A%A9%EB%9F%89-%ED%99%95%EC%9D%B8-%EB%B0%8F-%EB%B6%84%EC%84%9D" class="hash-link" aria-label="Direct link to 1단계: EIP 사용량 확인 및 분석" title="Direct link to 1단계: EIP 사용량 확인 및 분석">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># EIP 목록과 연결 상태 확인</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws ec2 describe-addresses --region ap-northeast-2 --output table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 각 EIP가 무엇에 연결되어 있는지 확인</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws ec2 describe-network-interfaces --region ap-northeast-2 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --network-interface-ids eni-xxxx eni-yyyy \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --query 'NetworkInterfaces[*].{NetworkInterfaceId:NetworkInterfaceId,Description:Description,Status:Status}'</span><br></span></code></pre></div></div>
<p><strong>결과 분석:</strong></p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"NetworkInterfaceId"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"eni-id"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"Description"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Interface for NAT Gateway nat-id"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"Status"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"in-use"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ... 5개의 EIP가 모두 NAT Gateway에 연결됨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2단계-terraform-상태-확인">2단계: Terraform 상태 확인<a href="https://indianapoly.github.io/en/blog/2025/07/19/terraform/terraform-errorHandling-title#2%EB%8B%A8%EA%B3%84-terraform-%EC%83%81%ED%83%9C-%ED%99%95%EC%9D%B8" class="hash-link" aria-label="Direct link to 2단계: Terraform 상태 확인" title="Direct link to 2단계: Terraform 상태 확인">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 현재 Terraform에서 관리하는 EIP 확인</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform plan | grep eip</span><br></span></code></pre></div></div>
<p><strong>결과:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aws_eip.nat["c"]: Refreshing state... [id=eipalloc-id]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws_eip.nat["a"]: Refreshing state... [id=eipalloc-id]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># aws_eip.nat["b"] will be created &lt;- 이 부분이 문제!</span><br></span></code></pre></div></div>
<p><strong>발견한 문제점:</strong></p>
<ul>
<li><code>nat["a"]</code>와 <code>nat["c"]</code>는 이미 Terraform 상태에 존재해요.</li>
<li><code>nat["b"]</code>만 새로 생성하려고 해서 EIP 한도 초과 발생가 발생했어요.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3단계-eip-문제-해결">3단계: EIP 문제 해결<a href="https://indianapoly.github.io/en/blog/2025/07/19/terraform/terraform-errorHandling-title#3%EB%8B%A8%EA%B3%84-eip-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0" class="hash-link" aria-label="Direct link to 3단계: EIP 문제 해결" title="Direct link to 3단계: EIP 문제 해결">​</a></h3>
<p><strong>방법 1: 기존 EIP 재사용</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 사용 가능한 EIP 확인 (a, c가 아닌 것들)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># eipalloc-id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># eipalloc-id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># eipalloc-id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 특정 EIP가 어떤 NAT Gateway에 연결되어 있는지 확인</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws ec2 describe-nat-gateways --region ap-northeast-2 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --query 'NatGateways[?NatGatewayAddresses[0].AllocationId==`eipalloc-id`].{NatGatewayId:NatGatewayId,State:State}'</span><br></span></code></pre></div></div>
<p><strong>결과:</strong></p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"NatGatewayId"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"nat-id"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"State"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"deleted"</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 이미 삭제됨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"NatGatewayId"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"nat-id"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"State"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"available"</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 사용 중</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre></div></div>
<p><strong>해결 단계:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 사용 중인 NAT Gateway 삭제</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws ec2 delete-nat-gateway --nat-gateway-id nat-id --region ap-northeast-2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 삭제 완료 대기</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws ec2 describe-nat-gateways --region ap-northeast-2 --nat-gateway-ids nat-id --query 'NatGateways[0].State'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. 해제된 EIP를 Terraform으로 가져오기</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform import 'aws_eip.nat["b"]' eipalloc-id</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4단계-기존-리소스-import">4단계: 기존 리소스 Import<a href="https://indianapoly.github.io/en/blog/2025/07/19/terraform/terraform-errorHandling-title#4%EB%8B%A8%EA%B3%84-%EA%B8%B0%EC%A1%B4-%EB%A6%AC%EC%86%8C%EC%8A%A4-import" class="hash-link" aria-label="Direct link to 4단계: 기존 리소스 Import" title="Direct link to 4단계: 기존 리소스 Import">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># EKS 클러스터 가져오기</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform import module.eks.aws_eks_cluster.this[0] cwave</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># KMS 별칭 가져오기 (따옴표 주의!)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform import 'module.eks.module.kms.aws_kms_alias.this["cluster"]' alias/eks/cwave</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># IAM 역할들 가져오기</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform import module.attach_efs_csi_role.aws_iam_role.this[0] efs-csi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform import module.ebs_csi_irsa.aws_iam_role.this[0] cwave-ebs-csi-controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform import module.lb_controller_role.aws_iam_role.this[0] eks-aws-lb-controller-role</span><br></span></code></pre></div></div>
<p><strong>Import 시 주의사항:</strong></p>
<ul>
<li>인덱스가 있는 리소스는 따옴표로 감싸주는 것이 중요해요.</li>
<li>정확한 리소스 이름과 ID 확인 필수입니다.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5단계-terraform-적용">5단계: Terraform 적용<a href="https://indianapoly.github.io/en/blog/2025/07/19/terraform/terraform-errorHandling-title#5%EB%8B%A8%EA%B3%84-terraform-%EC%A0%81%EC%9A%A9" class="hash-link" aria-label="Direct link to 5단계: Terraform 적용" title="Direct link to 5단계: Terraform 적용">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 계획 확인</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform plan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 문제없으면 적용</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform apply</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-kubectl-연결-문제-해결">🔧 kubectl 연결 문제 해결<a href="https://indianapoly.github.io/en/blog/2025/07/19/terraform/terraform-errorHandling-title#-kubectl-%EC%97%B0%EA%B2%B0-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0" class="hash-link" aria-label="Direct link to 🔧 kubectl 연결 문제 해결" title="Direct link to 🔧 kubectl 연결 문제 해결">​</a></h2>
<p>배포 완료 후 kubectl 명령어 실행 시 DNS 오류 발생:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get po</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Error: dial tcp: lookup .gr7.ap-northeast-2.eks.amazonaws.com on 127.0.0.11:53: no such host</span><br></span></code></pre></div></div>
<p><strong>해결 방법:</strong></p>
<p>업데이터를 새로 해줌으로써 기존 context를 switch를 진행해주면 정상적으로 동작하는 것을 확인할 수 있어요.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># kubeconfig 업데이트</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws eks update-kubeconfig --region ap-northeast-2 --name cwave</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 연결 테스트</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods -A</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-교훈-및-예방-방법">📝 교훈 및 예방 방법<a href="https://indianapoly.github.io/en/blog/2025/07/19/terraform/terraform-errorHandling-title#-%EA%B5%90%ED%9B%88-%EB%B0%8F-%EC%98%88%EB%B0%A9-%EB%B0%A9%EB%B2%95" class="hash-link" aria-label="Direct link to 📝 교훈 및 예방 방법" title="Direct link to 📝 교훈 및 예방 방법">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-개발-환경-관리-원칙">1. 개발 환경 관리 원칙<a href="https://indianapoly.github.io/en/blog/2025/07/19/terraform/terraform-errorHandling-title#1-%EA%B0%9C%EB%B0%9C-%ED%99%98%EA%B2%BD-%EA%B4%80%EB%A6%AC-%EC%9B%90%EC%B9%99" class="hash-link" aria-label="Direct link to 1. 개발 환경 관리 원칙" title="Direct link to 1. 개발 환경 관리 원칙">​</a></h3>
<ul>
<li><strong>환경별 폴더 분리 시 명확한 네이밍 사용</strong></li>
<li><strong>현재 작업 중인 환경을 항상 확인</strong></li>
<li><strong>환경 전환 시 기존 리소스 정리 후 진행</strong></li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 환경 확인 습관화</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pwd                    # 현재 작업 디렉터리 확인</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform workspace show  # Terraform 워크스페이스 확인</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws sts get-caller-identity  # 현재 AWS 계정/역할 확인</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-안전한-환경-전환-절차">2. 안전한 환경 전환 절차<a href="https://indianapoly.github.io/en/blog/2025/07/19/terraform/terraform-errorHandling-title#2-%EC%95%88%EC%A0%84%ED%95%9C-%ED%99%98%EA%B2%BD-%EC%A0%84%ED%99%98-%EC%A0%88%EC%B0%A8" class="hash-link" aria-label="Direct link to 2. 안전한 환경 전환 절차" title="Direct link to 2. 안전한 환경 전환 절차">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 기존 환경 정리</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform destroy -auto-approve</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 상태 파일 백업</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp terraform.tfstate terraform.tfstate.backup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 새 환경으로 이동</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd ../aws</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 리소스 확인 후 배포</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform plan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform apply</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-리소스-정리-시-주의점">3. 리소스 정리 시 주의점<a href="https://indianapoly.github.io/en/blog/2025/07/19/terraform/terraform-errorHandling-title#3-%EB%A6%AC%EC%86%8C%EC%8A%A4-%EC%A0%95%EB%A6%AC-%EC%8B%9C-%EC%A3%BC%EC%9D%98%EC%A0%90" class="hash-link" aria-label="Direct link to 3. 리소스 정리 시 주의점" title="Direct link to 3. 리소스 정리 시 주의점">​</a></h3>
<ul>
<li>EKS 클러스터 삭제 시 IAM 역할, KMS 별칭 등은 수동으로 삭제해주어야 해요.</li>
<li>만약 삭제해주어야 하는게 많다면 Terraform import를 활용하여 기존 리소스 재사용할 수 있어요.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-eip-관리">4. EIP 관리<a href="https://indianapoly.github.io/en/blog/2025/07/19/terraform/terraform-errorHandling-title#4-eip-%EA%B4%80%EB%A6%AC" class="hash-link" aria-label="Direct link to 4. EIP 관리" title="Direct link to 4. EIP 관리">​</a></h3>
<ul>
<li>AWS 계정의 EIP 한도를 미리 확인하는 것이 중요해요.</li>
<li>불필요한 EIP는 정기적으로 정리하고 필요시 AWS Support를 통해 한도 증가 요청해주어야 합니다.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-terraform-상태-관리">5. Terraform 상태 관리<a href="https://indianapoly.github.io/en/blog/2025/07/19/terraform/terraform-errorHandling-title#5-terraform-%EC%83%81%ED%83%9C-%EA%B4%80%EB%A6%AC" class="hash-link" aria-label="Direct link to 5. Terraform 상태 관리" title="Direct link to 5. Terraform 상태 관리">​</a></h3>
<ul>
<li><code>terraform plan</code>으로 생성될 리소스를 미리 확인하는 습관이 정말 중요합니다.</li>
<li>기존 리소스와의 충돌 가능성 검토 및 Import를 활용한 기존 리소스 재사용을 고려할 수 있어요.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-안전한-배포-전략">6. 안전한 배포 전략<a href="https://indianapoly.github.io/en/blog/2025/07/19/terraform/terraform-errorHandling-title#6-%EC%95%88%EC%A0%84%ED%95%9C-%EB%B0%B0%ED%8F%AC-%EC%A0%84%EB%9E%B5" class="hash-link" aria-label="Direct link to 6. 안전한 배포 전략" title="Direct link to 6. 안전한 배포 전략">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 배포 전 체크리스트</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform plan                    # 생성될 리소스 확인</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws ec2 describe-addresses        # EIP 사용량 확인</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws iam list-roles               # 기존 IAM 역할 확인</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws kms list-aliases             # 기존 KMS 별칭 확인</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="-결론">🎯 결론<a href="https://indianapoly.github.io/en/blog/2025/07/19/terraform/terraform-errorHandling-title#-%EA%B2%B0%EB%A1%A0" class="hash-link" aria-label="Direct link to 🎯 결론" title="Direct link to 🎯 결론">​</a></h2>
<p>이번 문제의 근본 원인은 <strong>개발 환경 혼동으로 인한 리소스 중복</strong>이었습니다. local과 aws 환경을 명확히 구분하지 않고 개발하다가, 기존 리소스를 정리하지 않은 상태에서 새로운 환경에 배포를 시도한 것이 문제의 시작이었습니다.</p>
<p>Terraform으로 AWS 리소스를 관리할 때는 다음 사항들을 반드시 고려해야 합니다:</p>
<ol>
<li><strong>환경 분리와 명확한 식별</strong></li>
<li><strong>기존 리소스와의 충돌 가능성</strong></li>
<li><strong>Terraform Import를 활용한 기존 리소스 재사용</strong></li>
</ol>
<p>특히 EKS와 같은 복잡한 서비스는 여러 AWS 서비스와 연동되어 있어, 삭제 시에도 일부 리소스가 남을 수 있습니다. 이런 상황에서는 <strong>Terraform Import</strong>를 활용하여 기존 리소스를 재사용하는 것이 가장 안전하고 효율적인 해결책입니다.</p>
<hr>
<p><strong>관련 명령어 모음:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 환경 확인</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pwd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform workspace show</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws sts get-caller-identity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># EIP 관련</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws ec2 describe-addresses --region ap-northeast-2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws ec2 release-address --allocation-id eipalloc-xxx --region ap-northeast-2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Terraform Import</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform import 'resource_address' resource_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform state list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">terraform plan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># EKS 관련</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws eks update-kubeconfig --region ap-northeast-2 --name cluster-name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config current-context</span><br></span></code></pre></div></div>]]></content:encoded>
            <category>TIL</category>
            <category>Terraform</category>
        </item>
        <item>
            <title><![CDATA[Kubernetes Basic(3)]]></title>
            <link>https://indianapoly.github.io/en/blog/2025/07/17/kubernetes/kubernetes-basic-3-title</link>
            <guid>https://indianapoly.github.io/en/blog/2025/07/17/kubernetes/kubernetes-basic-3-title</guid>
            <pubDate>Thu, 17 Jul 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[{/ truncate /}]]></description>
            <content:encoded><![CDATA[
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="secret">Secret<a href="https://indianapoly.github.io/en/blog/2025/07/17/kubernetes/kubernetes-basic-3-title#secret" class="hash-link" aria-label="Direct link to Secret" title="Direct link to Secret">​</a></h2>
<ul>
<li>생성하는 방법은 cli로 하거나 .yml 파일을 작성해서 만드는 방법이 있어요.</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create secret generic my-secret \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--from-literal=username=admin \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--from-literal=password=1234</span><br></span></code></pre></div></div>
<p>cli로 값을 확인을 해주려면, 아래 cli 명령을 통해서 yml을 출력할 수 있어요.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get secret my-secret -o yaml</span><br></span></code></pre></div></div>
<img src="https://indianapoly.github.io/img/blog/kubernetes/2025-07-17/img1.png">
<p>여기서 출력되는 데이터 역시 base64로 인코딩이 되기 때문에 이를 확인해주기 위해서는
복호화해주어야 해요.</p>
<p>yml 파일로 넣어줄때는 base64 인코딩된 값을 넣어주어야 해요.</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">secret2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Opaque</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> YWRtaW4= </span><span class="token comment" style="color:#999988;font-style:italic"># admin (base64 인코딩)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> MTIzNA== </span><span class="token comment" style="color:#999988;font-style:italic"># 1234 (base64 인코딩)</span><br></span></code></pre></div></div>
<p>위와 같이 설정을 하고 난 이후에 환경변수로 넘겨줄 수도 있고, 볼륨으로 넘겨줄 수도 있어요.</p>
<p>환경변수로 넘겨 줄때는 아래와 같이 key값을 지정해서 넘겨주어야 해요.</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mycontainer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> USERNAME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">valueFrom</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">secretKeyRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> username</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PASSWORD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">valueFrom</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">secretKeyRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> password</span><br></span></code></pre></div></div>
<p>볼륨으로 넘겨주는 것은 따로 key를 설정해주는 것이 아니라 생성한 secret를 전체 넘겨주어요.</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mycontainer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> secret</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">volume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/etc/secret"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">readOnly</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> secret</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">volume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">secret</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">secretName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">secret</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="statefulset">StateFulSet<a href="https://indianapoly.github.io/en/blog/2025/07/17/kubernetes/kubernetes-basic-3-title#statefulset" class="hash-link" aria-label="Direct link to StateFulSet" title="Direct link to StateFulSet">​</a></h2>
<ul>
<li>
<p>생성된 Pod마다 별도의 디스크 공간을 가져야하는 경우에 주로 사용해요. 분산 기반 애플리케이션의 경우 호스트명과 IP 등이 바뀌면 안돼요.</p>
</li>
<li>
<p>ReplicaSet의 경우에는 생성 및 삭제가 동시에 진행되는 반면에, StatefullSet은 순차적으로 진행되어서 시간 조절이 가능해요.</p>
</li>
<li>
<p>Pod를 삭제하는 경우 ID 값이 가장 큰 것부터 삭제가 돼요. 제일 마지막에 생성된 Pod가 먼저 삭제가 되고 마스터의 경우에는 가장 마지막에 삭제가 돼요.</p>
</li>
<li>
<p>스케일리에서 Pod가 삭제가 되면 해당 Pod가 물고 있는 PVC는 Pod에 대한 정보를 가지고 있어요. 따라서 Pod를 생성하면 이전과 동일한 ID로 재생성이 돼요.</p>
</li>
</ul>
<p>‼ Deployment는 Elastic Block Store를 사용하지 않아요. 만약 Deployment에 디스크를 붙히라고 한다면 EFS를 붙혀야 해요.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="kustomize--helm-차트">Kustomize / Helm 차트<a href="https://indianapoly.github.io/en/blog/2025/07/17/kubernetes/kubernetes-basic-3-title#kustomize--helm-%EC%B0%A8%ED%8A%B8" class="hash-link" aria-label="Direct link to Kustomize / Helm 차트" title="Direct link to Kustomize / Helm 차트">​</a></h2>
<p>2개를 같이 사용할 수 있지만 거의 같이 사용하지 않아요.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="kustomize">Kustomize<a href="https://indianapoly.github.io/en/blog/2025/07/17/kubernetes/kubernetes-basic-3-title#kustomize" class="hash-link" aria-label="Direct link to Kustomize" title="Direct link to Kustomize">​</a></h3>
<ul>
<li>base + overlay를 조합하여 환경별 배포 YAML을 kustomize build 명령으로 추출합니다.</li>
</ul>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kustomize/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── base/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── deployment.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── overlays/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── dev/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   └── kustomization.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── stage/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── prod/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── aws/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── gcp/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="helm-chart">Helm chart<a href="https://indianapoly.github.io/en/blog/2025/07/17/kubernetes/kubernetes-basic-3-title#helm-chart" class="hash-link" aria-label="Direct link to Helm chart" title="Direct link to Helm chart">​</a></h3>
<ul>
<li>
<p>예를 들어서 MYSQL 개발자가 yml을 제공을 하고 소비자가 환경변수나 설정 등을 변경하고 싶을 때 :</p>
<ul>
<li>개발자가 Helm 차트를 활용하면 변경 가능한 인터페이스를 제공해줘요. 이를 통해서 사용자는 환경변수나 설정을 쉽게 바꿀 수 있어요.</li>
</ul>
</li>
</ul>
<p><strong>설치 방법</strong></p>
<p>아래와 같은 명령어를 순서대로 입력을 해주면 helm chart를 설치할 수 있어요.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chmod 700 get_helm.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./get_helm.sh</span><br></span></code></pre></div></div>
<p>잘 설치가 되었는지 확인하기 위해서 mysql를 검색을 해보면 잘 나오는 것을 확인할 수 있어요.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm show chart stable/mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">appVersion: 5.7.30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deprecated: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">description: DEPRECATED - Fast, reliable, scalable, and easy to use open-source relational</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  database system.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">home: https://www.mysql.com/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">icon: https://www.mysql.com/common/logos/logo-mysql-170x115.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">keywords:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- database</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name: mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- https://github.com/kubernetes/charts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- https://github.com/docker-library/mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">version: 1.6.9</span><br></span></code></pre></div></div>
<p><strong>helm chart 생성하기</strong></p>
<p>해당 명령어를 통해서 생성해주세요.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm create &lt;이름&gt;</span><br></span></code></pre></div></div>
<p>templates 폴더에서 deployment.yml와 service.yml을 생성을 해줘요. _helpers.tpl을 제외한 나머지 파일들은 삭제를 진행해줘요.</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># deployment.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> .Values.container.name </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> .Values.replicas </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> .Values.container.name </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> .Values.container.name </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> .Values.environment </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> .Values.container.name </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> .Values.container.image </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> .Values.container.tag </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> .Values.container.port </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> .Values.environment </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># service.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> .Values.container.name </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> .Values.container.name </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> .Values.container.port </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> .Values.container.name </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> LoadBalancer</span><br></span></code></pre></div></div>
<p>기존의 values.yaml을 전체 삭제를 해줘요. 그런다음에 아래를 넣어줘요. 이렇게 하면 사용자는 여기에 지정된 변수만 건들 수 있다는 것을 알려줘요.</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> development</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">container</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tag</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><br></span></code></pre></div></div>
<p>위에서 작업한 것을 설치를 진행해줘요.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm install nginxstd ./nginxstd</span><br></span></code></pre></div></div>
<p>패키지를 생성해주고 파일을 이동시켜줍니다. 그리고 helm repository 파일을 생성해요.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm package ./nginxstd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv ./nginx-std-0.1.0.tgz ./prod/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 리포지토리 파일 생성 (index.yaml)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">heml repo index ./prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 파일 생성 확인</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat ./prod/index.yaml</span><br></span></code></pre></div></div>
<p>위 작업까지 다 했다면 Github Repository를 만들어요. 그리고 Repository에 우리가 작업한 것을 올려줘요. Github에 정상적으로 등록이 완료가 되었다면 아래 명령어를 통해서 repository를 추가시켜줍니다.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo add helm-prod &lt;자신 github 주소에 올라가 있는 helm Repository&gt;</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="실습">실습<a href="https://indianapoly.github.io/en/blog/2025/07/17/kubernetes/kubernetes-basic-3-title#%EC%8B%A4%EC%8A%B5" class="hash-link" aria-label="Direct link to 실습" title="Direct link to 실습">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mysql-db-secret-생성-및-사용">MySQL DB Secret 생성 및 사용<a href="https://indianapoly.github.io/en/blog/2025/07/17/kubernetes/kubernetes-basic-3-title#mysql-db-secret-%EC%83%9D%EC%84%B1-%EB%B0%8F-%EC%82%AC%EC%9A%A9" class="hash-link" aria-label="Direct link to MySQL DB Secret 생성 및 사용" title="Direct link to MySQL DB Secret 생성 및 사용">​</a></h3>
<p>Secret를 생성하는데 요구조건은 아래와 같아요. 해당 내용을 넣기 위해서는 그대로 작성하는 것이 아니라 base64로 인코딩을 진행해야해요.</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MYSQL_USER: user1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MYSQL_PASSWORD: pw1234</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MYSQL_ROOT_PASSWORD: rootpw9876</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MYSQL_DATABASE: mydb</span><br></span></code></pre></div></div>
<p>첫 번째로 Secret를 생성을 해요.</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">MYSQL_USER</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> dXNlcjE= </span><span class="token comment" style="color:#999988;font-style:italic">#user1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">MYSQL_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cHcxMjM0 </span><span class="token comment" style="color:#999988;font-style:italic">#pw1234</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">MYSQL_ROOT_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cm9vdHB3OTg3Ng== </span><span class="token comment" style="color:#999988;font-style:italic">#rootpw9876</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">MYSQL_DATABASE</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> bXlkYg== </span><span class="token comment" style="color:#999988;font-style:italic">#mydb</span><br></span></code></pre></div></div>
<p><code>kubectl apply -f ./파일이름</code> 명령어로 실행을 하면 생성이 돼요.</p>
<p>생성을 해준다음에 환경변수 방법을 사용해서 Pod를 생성을 해줄거에요. 이 때 secretKeyRef의 이름을 생성한 secret의 이름으로 지정을 해주면 돼요.</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">secret</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> MYSQL_USER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">valueFrom</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">secretKeyRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> MYSQL_USER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> MYSQL_PASSWORD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">valueFrom</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">secretKeyRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> MYSQL_PASSWORD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> MYSQL_ROOT_PASSWORD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">valueFrom</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">secretKeyRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> MYSQL_ROOT_PASSWORD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> MYSQL_DATABASE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">valueFrom</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">secretKeyRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> MYSQL_DATABASE</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="statefulset-1">StatefulSet<a href="https://indianapoly.github.io/en/blog/2025/07/17/kubernetes/kubernetes-basic-3-title#statefulset-1" class="hash-link" aria-label="Direct link to StatefulSet" title="Direct link to StatefulSet">​</a></h3>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> StatefulSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nodejs</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sfs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nodejs</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sfs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">serviceName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nodejs</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sfs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nodejs</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sfs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nodejs</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sfs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hyeonlim/nodejs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">sfs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">volumeClaimTemplates</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">accessModes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ReadWriteOnce</span><br></span></code></pre></div></div>
<p>해당 작업을 통해서 아래와 같은 리스소를 가지는 PVC를 만들어주고, volumeClaimTemplates를 통해서 Pod 마다 독립적인 PVC를 만들 수 있어요.</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">accessModes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ReadWriteOnce</span><br></span></code></pre></div></div>
<p>위 작업이 마무리가 되고 나면 load balancer를 설정하여 트래픽을 Pod 별로 분산을 진행해줘요.</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nodesjs</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sfs</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">lb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">service.beta.kubernetes.io/aws-load-balancer-type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> external</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">service.beta.kubernetes.io/aws-load-balancer-nlb-target-type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">service.beta.kubernetes.io/aws-load-balancer-scheme</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> internet</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">facing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> LoadBalancer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">sessionAffinity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nodejs</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sfs</span><br></span></code></pre></div></div>
<p>✅ 중요한 점</p>
<ul>
<li>
<p>StatefulSet Pod마다 데이터가 다르면, 로드밸런서로 접근한 사용자마다 다른 결과를 받게 돼요. 따라서 이러한 문제를 해결하기 위해서</p>
<ul>
<li>
<p>Shared Storage (NFS, S3)를 사용해요.</p>
</li>
<li>
<p>사용자 마다 Pod 접속을 고정을 시킬 수 있어요. sticky session이라고 해요. 아래와 같은 예시로 설정을 해줄 수 있어요.</p>
</li>
</ul>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">sessionAffinity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ClientIP</span><br></span></code></pre></div></div>
</li>
</ul>]]></content:encoded>
            <category>TIL</category>
            <category>Kubernetes</category>
        </item>
        <item>
            <title><![CDATA[Kubernetes Basic(2)]]></title>
            <link>https://indianapoly.github.io/en/blog/2025/07/16/kubernetes/kubernetes-basic-2-title</link>
            <guid>https://indianapoly.github.io/en/blog/2025/07/16/kubernetes/kubernetes-basic-2-title</guid>
            <pubDate>Wed, 16 Jul 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[{/ truncate /}]]></description>
            <content:encoded><![CDATA[
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="volume">volume<a href="https://indianapoly.github.io/en/blog/2025/07/16/kubernetes/kubernetes-basic-2-title#volume" class="hash-link" aria-label="Direct link to volume" title="Direct link to volume">​</a></h2>
<ul>
<li>
<p><code>Persistent Volume Access Mode</code>의 모델은 아래 4개의 모드가 있어요.</p>
<ul>
<li>ReadWriteOnce (RWO)</li>
<li>ReadOnlyMany (ROX) : 로그를 주로 읽을 때 사용해요.</li>
<li>ReadWriteMany (RWX) : 분산형 데이터베이스에서 주로 사용해요.</li>
<li>ReadWriteOncePOD (RWOP)</li>
</ul>
</li>
<li>
<p>컨테이너는 볼륨을 마운트를 하면 POD 안에서는 공유가 가능해져요. 노드 입장에서 보면 해당 노드에 속해있는 POD에 대해서는 같이 읽고 쓸 수 있다는 것을 의미해요.</p>
</li>
<li>
<p>pv-w-pvc 와 pv-w-sc의 차이점을 아시나요?</p>
<ul>
<li>pv-w-pvc는 AWS의 Elastic Blokc Store 의 디스크 중 하나를 볼륨으로 설정해요. zone에 해당하는 볼륨을 설정하고 해당 볼륨을 pv로 해야지만 k8s가 해당 볼륨을 인식을 해요.
pvc를 설장하기 위해서는 storageClassName을 빈문자열로 두면 돼요.<!-- -->
<ul>
<li>pvc는 pod와 상관이 없어요. pod가 삭제된다고 해서 pvc가 삭제되는 것은 아니에요.</li>
</ul>
</li>
</ul>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">storageClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">""</span><br></span></code></pre></div></div>
<ul>
<li>pv-w-sc는 sc(aws에서는 gp2라고 해요.)를 설정만 해두면 pv-w-pvc의 과정을 자동으로 설정해요. 이후 과정은 pvc와 동일하게 진행이 되요. 이렇게 진행을 디스크를 삭제하고 생성하는 책임이 개발자로 역할이 넘어가면서 관리자의 관리 부담이 줄어들어요.<!-- -->
<ul>
<li>gp2를 default를 설정하기 위해서는 아래와 같은 명령어를 작성을 해줘요.</li>
</ul>
</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  kubectl patch storageclass gp2 -p '{"metadata": {"annotations":{"storageclass.kubernetes.io/is-default-class":"true"}}}'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ul>
<li>따라서 pvc는 정적 프로비저닝이라고 하고, sc는 동적 프로비저닝이라고 해요.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cicd">CICD<a href="https://indianapoly.github.io/en/blog/2025/07/16/kubernetes/kubernetes-basic-2-title#cicd" class="hash-link" aria-label="Direct link to CICD" title="Direct link to CICD">​</a></h2>
<ul>
<li>AWS에는 code deploy(CI), commit, code pipe line(CD) 이렇게 3가지의 서비스가 있어요.<!-- -->
<ul>
<li>commit은 곧 없어질 예정이에요.</li>
<li>code deploy를 사용하려면 산출된 결과물(압축 파일)을 S3에 저장을 해야해요. - app.spec.yml 파일이 있어야 해여.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ci-continuous-integration">CI: continuous Integration<a href="https://indianapoly.github.io/en/blog/2025/07/16/kubernetes/kubernetes-basic-2-title#ci-continuous-integration" class="hash-link" aria-label="Direct link to CI: continuous Integration" title="Direct link to CI: continuous Integration">​</a></h3>
<p>CI의 순서는 아래와 같아요.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">빌드 -&gt; 테스트(테스트의 종류에는 유닛 테스트, e2e 테스트, 부하 테스트가 있어요) -&gt; 취약점 검사 (코드 정적 분석) -&gt; 코드 리뷰 | 코드 컨밴션</span><br></span></code></pre></div></div>
<ul>
<li>예전에는 최종산출물이 Artifact이 나왔어요. Artifact는 .jar 이런게 있어요.</li>
<li>요즘에는 최종산출물이 container image가 나와요.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cd-continuous-delivery-deployment">CD: continuous Delivery, Deployment<a href="https://indianapoly.github.io/en/blog/2025/07/16/kubernetes/kubernetes-basic-2-title#cd-continuous-delivery-deployment" class="hash-link" aria-label="Direct link to CD: continuous Delivery, Deployment" title="Direct link to CD: continuous Delivery, Deployment">​</a></h3>
<ul>
<li>
<p>Delivery는 마지막 배포는 사림이 직접 진행을 해요. 하지만 Deployment는 배포하는 전과정이 자동으로 이루어져요.</p>
</li>
<li>
<p>주로 사용되는 CI,CD 툴은 github action, gitlab runner, Jenkins, CircleCI pipe, bitbucket pipeline 등이 활용이 돼요.</p>
<ul>
<li>github action : 많이 사용되는 이유는 접근하기 쉽기 때문이에요. 코드가 공개가 되어있어 보안상 문제가 있을 거 같지만 매일 fetch가 이루어지기 때문에 보안상 안전해요.</li>
<li>gitlab runner : 설치해서 사용을 해요. (공공기관 같은데에서 주로 사용해요.)</li>
<li>Circle CI : 오픈소스 프로젝트에서 많이 사용해요.</li>
<li>Jenkins: 스크립트형으로 작성되기 때문에 명령형이에요.</li>
</ul>
</li>
<li>
<p>CD만 전문적으로 하는 도구들이 있는데 나온 이유는 컨테이너가 나오면서 배포 전략이 다양하게 생겼기 때문이에요.</p>
<ul>
<li>ArgoCD (제일 빠르다는 점 때문에 제일 많이 사용해요.)</li>
<li>FluxCD</li>
<li>Spinnake (대규모 시스템이 적합해요.)</li>
<li>JenkinsX</li>
</ul>
</li>
</ul>
<hr>
<h1>실습</h1>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="랜덤으로-명언을-보여주는-간단한-서비스empty-dir">랜덤으로 명언을 보여주는 간단한 서비스(empty dir)<a href="https://indianapoly.github.io/en/blog/2025/07/16/kubernetes/kubernetes-basic-2-title#%EB%9E%9C%EB%8D%A4%EC%9C%BC%EB%A1%9C-%EB%AA%85%EC%96%B8%EC%9D%84-%EB%B3%B4%EC%97%AC%EC%A3%BC%EB%8A%94-%EA%B0%84%EB%8B%A8%ED%95%9C-%EC%84%9C%EB%B9%84%EC%8A%A4empty-dir" class="hash-link" aria-label="Direct link to 랜덤으로 명언을 보여주는 간단한 서비스(empty dir)" title="Direct link to 랜덤으로 명언을 보여주는 간단한 서비스(empty dir)">​</a></h3>
<p>속도가 느리다고 한다면 이것을 사용해서 빠르게 처리할 수 있어요.
medium: Memory를 설정을 하면 OS의 메모리 기반 파일시스템을 사용해요. 따라서 디스크보다 더 빠른 I/O 성능을 제공해요.</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cache</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">volume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">emptyDir</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">medium</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Memory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">sizeLimit</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 64Mi</span><br></span></code></pre></div></div>
<p>해당 프로젝트의 경우 context는 aws로 설정이 되어있어요.</p>
<p>왜 해당 프로젝트에서는 emptyDir이 적절할까요?</p>
<ul>
<li>명언 데이터들은 휘발성/임시 콘텐츠이므로, Pod가 재시작되면 새로 생성되어도 무방해요.</li>
<li>html-generator가 생성하고, nginx가 읽어야하므로 공유 스토리지가 필요해요. 그런데 외부 스토리지 연동이 불필요하기 때문이기도 해요.</li>
<li>속도 역시 빠르다는 장점이 있어요.</li>
</ul>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> fortune</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> fortune</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> fortune</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> fortune</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &lt;이미지를 가져와야해요.</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> html</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">generator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /var/htdocs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">alpine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /usr/share/nginx/html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">readOnly</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">protocol</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">emptyDir</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># fortune-lb.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> fortune</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">lb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># annotations을 설정 해주지 않으면 aws에서는 외부에 접속을 허용하지 않아요.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># VPC 외부 접속이 가능하도록 해요.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">service.beta.kubernetes.io/aws-load-balancer-type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> external</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 노드가 아니라 POD IP로 직접 전달해요.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">service.beta.kubernetes.io/aws-load-balancer-nlb-target-type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 공인 IP를 사용할 수 있어요.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">service.beta.kubernetes.io/aws-load-balancer-scheme</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> internet</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">facing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> fortune</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> LoadBalancer</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="docker-arg-vs-yaml-env-vs-configmap-env-비교-실습">Docker ARG vs Yaml ENV vs CONFIGMAP ENV 비교 실습<a href="https://indianapoly.github.io/en/blog/2025/07/16/kubernetes/kubernetes-basic-2-title#docker-arg-vs-yaml-env-vs-configmap-env-%EB%B9%84%EA%B5%90-%EC%8B%A4%EC%8A%B5" class="hash-link" aria-label="Direct link to Docker ARG vs Yaml ENV vs CONFIGMAP ENV 비교 실습" title="Direct link to Docker ARG vs Yaml ENV vs CONFIGMAP ENV 비교 실습">​</a></h3>
<p>Docker ARG의 경우에는 args를 설정하여 넘겨줄 수 있어요.</p>
<div class="language-Dockerfile language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - image: hyeonlim/fortune:args</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    args: ["5"]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: html-generator</span><br></span></code></pre></div></div>
<p>yml을 통해서도 args를 설정해줄 수 있어요. 설정은 yml 파일에 아래와 같이 설정을 해주면 돼요.</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 컨테이너의 매개변수가 아니라 환경변수로 들어가요. 따라서 효율적으로 전달을 할 수 있어요.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> INTERVAL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"30"</span><br></span></code></pre></div></div>
<p>CONFIGMAP을 생성을 해줄 수 있어요. 아래 명령어를 통해 확인도 가능해요.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create configmap fortune-config --from-literal=sleep-interval=7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get cm fortune-config</span><br></span></code></pre></div></div>
<p>아래 사진의 cli를 입력하게 되면 사진과 같이 값이 들어가 있는 것을 확인할 수 있어요.</p>
<img src="https://indianapoly.github.io/img/blog/kubernetes/2025-07-16/img1.png">
<ul>
<li>Kubernetes Pod에서 ConfigMap의 값을 환경 변수로 주입할 때 사용하지만 목적과 범위가 달라요.</li>
</ul>
<img src="https://indianapoly.github.io/img/blog/kubernetes/2025-07-16/img2.png">
<ul>
<li>해당 사진에서는 특정 Key만 환경 변수로 주입이 되고 개별 환경 변수 설정이 필요할 때 주로 사용해요.</li>
</ul>
<img src="https://indianapoly.github.io/img/blog/kubernetes/2025-07-16/img3.png">
<ul>
<li>해당 사진은 ConfigMap의 모든 Key를 환경 변수로 자동 주입해요. 모든 설정을 한꺼번에 주입하고 싶을 때 사용해요.</li>
</ul>]]></content:encoded>
            <category>TIL</category>
            <category>Kubernetes</category>
        </item>
        <item>
            <title><![CDATA[개발하기 전 아이디어 회의 이렇게 해보자.]]></title>
            <link>https://indianapoly.github.io/en/blog/2025/07/16/etc/idea_meeting-title</link>
            <guid>https://indianapoly.github.io/en/blog/2025/07/16/etc/idea_meeting-title</guid>
            <pubDate>Wed, 16 Jul 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[{/ truncate /}]]></description>
            <content:encoded><![CDATA[
<p>cloudwave에서 진행했던 idea 회의와 관련된 회고에요. 앞으로 도움이 될 거 같아서 기록 해두어요.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="주제">주제<a href="https://indianapoly.github.io/en/blog/2025/07/16/etc/idea_meeting-title#%EC%A3%BC%EC%A0%9C" class="hash-link" aria-label="Direct link to 주제" title="Direct link to 주제">​</a></h2>
<p><code>대학생을 위한 완벽한 아침 루틴에 대한 고민</code> 이에요. 이 때 수면을 시간을 잘 지키고 추가적으로 건강한 루틴을 만드는 것이 목표인 것을 잊지 말아야 해요.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="process">process<a href="https://indianapoly.github.io/en/blog/2025/07/16/etc/idea_meeting-title#process" class="hash-link" aria-label="Direct link to process" title="Direct link to process">​</a></h2>
<ol>
<li>
<p><code>07시 기상</code>, <code>09시 자리 착석</code> 해당 2개의 시작점과 끝점은 고정을 한 상태에서 통학 시간이 1시간임을 고려해서 각자의 아침 루틴을 만들어요.
ex. 기상 -&gt; 식사 -&gt; 옷을 입는다 -&gt; 집을 나간다 -&gt; 지하철을 탄다 -&gt; .. -&gt; 자리에 착석한다.</p>
<p>이렇게 각자만의 루틴을 만들었어요.</p>
</li>
<li>
<p>각자 만든 루틴들을 팀원들에게 설명을 해요. 이때 팀원들은 모든 질문에 대해서 의문을 가지고 하나하나 물어보는 작업을 진행을 해요.</p>
</li>
<li>
<p>그리고 만든 루틴 중 제일 괜찮다 아니면 해보고 싶다 하는 사람이 손을 들어요. 해당 손을 든 사람은 이제 Product Owner가 돼요.</p>
</li>
<li>
<p>각자 만든 루틴들을 모두 합쳐요. 동일한 카테고리에 대해서는 하나의 문제로 처리를 하고, 분야가 다르면 무조건 분리 시키는게 중요해요.</p>
</li>
<li>
<p>4번에서 만든 결과물을 바탕으로 투표를 진행을 해요. 먼저 PO가 아닌 사람들이 x개의 투표권을 가지고 꼭 있어야 하는 것들에 대해서 투표를 진행해요. 그리고 PO는 투표권의 수와 관계 없이 투표를 하는데 이 때 PO가 선택한 것은 무조건 채택이 되기 때문에 PO의 선택으로 제품의 방향성이 바뀔 수도 있어요.</p>
</li>
<li>
<p>투표를 한 것을 바탕으로 4번에 만든 흐름 밑에 검은 줄을 하나 만들고, 해당 프로세스에서 출발 시간을 07시 30분에 출발하는 것으로 변경을 했을 때, 5번의 결과에서 꼭 필요 없는 것들을 아래 칸으로 내려요. 이 때 PO의 선택은 절대 내리지 않아요.</p>
</li>
<li>
<p>6번의 결과물 밑에 검은 줄을 하나 또 만들고, 그 다음에 해당 프로세스를 출 시간이 07시 50분이라고 했을 때 꼭 필요한 것들만 남기고 나머지는 내리는 작업을 진행을 해요.</p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="우리가-했던-것에-대한-결과물">우리가 했던 것에 대한 결과물<a href="https://indianapoly.github.io/en/blog/2025/07/16/etc/idea_meeting-title#%EC%9A%B0%EB%A6%AC%EA%B0%80-%ED%96%88%EB%8D%98-%EA%B2%83%EC%97%90-%EB%8C%80%ED%95%9C-%EA%B2%B0%EA%B3%BC%EB%AC%BC" class="hash-link" aria-label="Direct link to 우리가 했던 것에 대한 결과물" title="Direct link to 우리가 했던 것에 대한 결과물">​</a></h2>
<ul>
<li>
<p>그러면 총 3개의 영역이 나오게 되는데 이 때 07시 50분일 때 꼭 하는 것이 MVP가 되고 이는 fix가 돼요. 그리고 아리 07시 30분에 진행하는 것이 release 1 되고 그 이후는 release 2가 돼요.</p>
</li>
<li>
<p>우리는 해당 과정을 해오면서 기능을 시간 순으로 표시를 했어요. 왜냐하면 완료 시간은 고정이 되어있기 때문이에요. 또한 발산하는 과정을 거치고, 동일한 카테고리에 대해서 의견을 합치면서 수렴하는 과정을 거쳤어요.</p>
</li>
<li>
<p>여기서 중요한 것은 각 release는 1개의 기능을 해야해요. 즉 자동차를 만드는 MVP가 있었다고 한다면. 다음 release는 바퀴를 만드는 것이 아니라 오토바이나 혹은 다른 기능을 하는 것이 만들어져야 하는 것을 의미해요.</p>
</li>
<li>
<p>또한 여기서 우리는 아직 안정한게 있는데 바로 페르소나에요. 대학생을 타겟으로 했는데 어떤 대학생을 타겟으로 했는지 기준이 없어요. 페르소나가 없다면 제품이 어떠한 방향으로 나아가는지에 대해서 불명확해지고 프로젝트가 원하는 방향성으로 흘러가지 못할 수 있어요.</p>
</li>
</ul>]]></content:encoded>
            <category>TIL</category>
            <category>Etc</category>
        </item>
        <item>
            <title><![CDATA[kubernetes Basic (1)]]></title>
            <link>https://indianapoly.github.io/en/blog/2025/07/15/kubernetes/kubernetes-basic-1-title</link>
            <guid>https://indianapoly.github.io/en/blog/2025/07/15/kubernetes/kubernetes-basic-1-title</guid>
            <pubDate>Tue, 15 Jul 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[{/ truncate /}]]></description>
            <content:encoded><![CDATA[
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="deployment">Deployment<a href="https://indianapoly.github.io/en/blog/2025/07/15/kubernetes/kubernetes-basic-1-title#deployment" class="hash-link" aria-label="Direct link to Deployment" title="Direct link to Deployment">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-recreate-재가동-방식-v1--v2">1. RECREATE (재가동 방식: v1 → v2)<a href="https://indianapoly.github.io/en/blog/2025/07/15/kubernetes/kubernetes-basic-1-title#1-recreate-%EC%9E%AC%EA%B0%80%EB%8F%99-%EB%B0%A9%EC%8B%9D-v1--v2" class="hash-link" aria-label="Direct link to 1. RECREATE (재가동 방식: v1 → v2)" title="Direct link to 1. RECREATE (재가동 방식: v1 → v2)">​</a></h3>
<p>특징: 서비스 중단 발생</p>
<p>장점: 설정이 쉬움</p>
<p>비고: 현업에서 가장 흔히 사용되며, 서비스 중단을 감수해야 하는 방식</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-ramped-rolling-update">2. RAMPED (Rolling Update)<a href="https://indianapoly.github.io/en/blog/2025/07/15/kubernetes/kubernetes-basic-1-title#2-ramped-rolling-update" class="hash-link" aria-label="Direct link to 2. RAMPED (Rolling Update)" title="Direct link to 2. RAMPED (Rolling Update)">​</a></h3>
<p>특징: 순차적으로 연결 시도 → 무중단 서비스 제공</p>
<p>설정 방법:</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> RollingUpdate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">maxSurge</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 예) 1 → replicas + maxSurge 만큼 pod 생성 가능</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">maxUnavailable</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 예) 1 → replicas 중 동시에 중단 가능한 pod 수</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">⇒ 위 2개의 옵션을 통해서 재가동 속도를 제어할 수 있음</span><br></span></code></pre></div></div>
<p>추가 설정<!-- -->:Sticky<!-- --> session: 버전 간 이동 방지</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-blue--green-배포">3. Blue / Green 배포<a href="https://indianapoly.github.io/en/blog/2025/07/15/kubernetes/kubernetes-basic-1-title#3-blue--green-%EB%B0%B0%ED%8F%AC" class="hash-link" aria-label="Direct link to 3. Blue / Green 배포" title="Direct link to 3. Blue / Green 배포">​</a></h3>
<p>특징: selector의 버전 변경으로 전체 교체</p>
<p>사용 목적:개발 버전을 운영에 바로 반영해야 하는 상황</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-canary-배포">4. Canary 배포<a href="https://indianapoly.github.io/en/blog/2025/07/15/kubernetes/kubernetes-basic-1-title#4-canary-%EB%B0%B0%ED%8F%AC" class="hash-link" aria-label="Direct link to 4. Canary 배포" title="Direct link to 4. Canary 배포">​</a></h3>
<p>특징: ramped와 유사하지만, 일부 트래픽으로 먼저 안정성 검증 후 전체 이전</p>
<p>설정: replicas: 9(v1), 1(v2) 설정, RouteRule의 route → weight 설정으로 손쉽게 설정 가능</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-ab-테스트">5. A/B 테스트<a href="https://indianapoly.github.io/en/blog/2025/07/15/kubernetes/kubernetes-basic-1-title#5-ab-%ED%85%8C%EC%8A%A4%ED%8A%B8" class="hash-link" aria-label="Direct link to 5. A/B 테스트" title="Direct link to 5. A/B 테스트">​</a></h3>
<p>특징 : header, cookie 기반으로 사용자 그룹 분리</p>
<p>사용 목적: UI나 기능 개선의 효과를 확인하고자 할 때 (새로운 UI가 구매율을 높이는지 확인)</p>
<p>설정: match에 header 조건 추가</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-shadow-트래픽-미러링">6. Shadow 트래픽 (미러링)<a href="https://indianapoly.github.io/en/blog/2025/07/15/kubernetes/kubernetes-basic-1-title#6-shadow-%ED%8A%B8%EB%9E%98%ED%94%BD-%EB%AF%B8%EB%9F%AC%EB%A7%81" class="hash-link" aria-label="Direct link to 6. Shadow 트래픽 (미러링)" title="Direct link to 6. Shadow 트래픽 (미러링)">​</a></h3>
<p>사용 목적: 기존 성능 개선을 위해 (예시 : Monolith → Microservice 구조 전환 시 유용)</p>
<p>설정: mirror 설정으로 실제 요청을 복제하여 테스트 환경으로 전달</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="service">Service<a href="https://indianapoly.github.io/en/blog/2025/07/15/kubernetes/kubernetes-basic-1-title#service" class="hash-link" aria-label="Direct link to Service" title="Direct link to Service">​</a></h2>
<p>쿠버네티스의 서비스는 기본적으로 네트워크이다. (물리적인 것이 아니다.)</p>
<p>(쿠버네티스의 pod가 죽고 다른 노드로 이동하면 IP가 변동이되는데, 쿠버네티스 안에는 규칙 기반의 DNS 서버스가 있다.)</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cluster-ip">cluster IP<a href="https://indianapoly.github.io/en/blog/2025/07/15/kubernetes/kubernetes-basic-1-title#cluster-ip" class="hash-link" aria-label="Direct link to cluster IP" title="Direct link to cluster IP">​</a></h3>
<p>디폴트 서비스, layer4 =&gt; 내부에만 접속이 가능하다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="node-port">Node Port<a href="https://indianapoly.github.io/en/blog/2025/07/15/kubernetes/kubernetes-basic-1-title#node-port" class="hash-link" aria-label="Direct link to Node Port" title="Direct link to Node Port">​</a></h3>
<p>트래픽이 오면 노드의 특정 포트에 도착하고, 클러스터 IP로 가고 이를 분기 시킨다.</p>
<ul>
<li>개발자들이 확인하기 위해서 주로 사용하고 웬만하면 사용하지 않는다.</li>
<li>노드를 만드는 이유는?<!-- -->
<ul>
<li>트래픽이 몰리는 것을 반응하기 위함이다.</li>
<li>어떤 노드에 규칙을 적용해서 작업하기 위함이다.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="load-balancer">Load Balancer<a href="https://indianapoly.github.io/en/blog/2025/07/15/kubernetes/kubernetes-basic-1-title#load-balancer" class="hash-link" aria-label="Direct link to Load Balancer" title="Direct link to Load Balancer">​</a></h3>
<p>트래픽이 들어오면 나놈. cluster ip와 다른 점은 cluster ip는 내부에 있고 로드밸런서는 외부에 위치해있다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ingress">Ingress<a href="https://indianapoly.github.io/en/blog/2025/07/15/kubernetes/kubernetes-basic-1-title#ingress" class="hash-link" aria-label="Direct link to Ingress" title="Direct link to Ingress">​</a></h3>
<p>외부에 위치에 있음. 로드 밸런서와의 차이점은 로드 밸런서는 layer4이고 Ingress는 layer7이다. (layer1~layer7까지 확인을 해볼 수 있다.)</p>
<p>사용자가 xxx.xxx.xxx.com이 접속을 하면
igw를 통해 ingress(퍼블릭 도메인이 자동 활동, ALB, NLB)에 들어오고 k8s 서비스에 접속이 된다. 첫 번째 껍데기는 replicaset 두 번째 껍데기는 deployment
ingress만 생성하는 것이 아니라 내부 서비스를 생성해야 통신이 된다.</p>
<p>쿠버네티스 안에 LB controller가 ingress를 생성하고, 상태를 감시한다. 그리고 삭제도 해준다.</p>
<ul>
<li>ingress를 삭제하고 테라폼을 삭제하는 것이 더 빠르다. ingress는 외부 서비스이기 때문이다.</li>
</ul>
<p>✅ <strong>왜 ELB IP가 3개 나오는가?</strong></p>
<img src="https://indianapoly.github.io/img/blog/kubernetes/2025-07-15/img1.png" alt="설명" width="600">
<p>AWS에서 Network Load Balancer(NLB)는 <strong>서브넷이 존재하는 모든 가용영역(AZ)</strong> 에 <strong>자동으로
IP를 할당</strong>합니다. 이는 고가용성(High Availability)을 보장하기 위한 기본 동작이다.</p>
<ol>
<li>서울 리전(<code>ap-northeast-2</code>)에서 VPC 생성</li>
</ol>
<ul>
<li>아래와 같이 <strong>3개의 프라이빗 서브넷 생성</strong>:</li>
</ul>
<div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">variable "private_subnet_cidrs" {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type = map(string)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    a = "10.1.4.0/24"  // ap-northeast-2a (8층)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b = "10.1.5.0/24"  // ap-northeast-2b (9층)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c = "10.1.6.0/24"  // ap-northeast-2c (10층)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<ol start="2">
<li>EKS 클러스터 생성</li>
</ol>
<p><img src="https://indianapoly.github.io/img/blog/kubernetes/2025-07-15/img2.png" alt="설명" width="600">-</p>
<p>EKS클러스터를 생성하면 노드 그룹을 구성 - 노드는 2개에만 배치가 된다.</p>
<ol start="3">
<li>Ingress 생성</li>
</ol>
<ul>
<li>Ingress 리소서를 생성을 하면 AWS에서 NLB 자동 생성</li>
<li>NLB는 연결된 서브넷에 있는 모든 AZ에 IP를 할당</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="headless-service">Headless service<a href="https://indianapoly.github.io/en/blog/2025/07/15/kubernetes/kubernetes-basic-1-title#headless-service" class="hash-link" aria-label="Direct link to Headless service" title="Direct link to Headless service">​</a></h3>
<p>아래와 같이 설정을 하면 headless service가 된다.</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">clusterIP</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> None</span><br></span></code></pre></div></div>
<p>Headless를 하면 pod로 가는게 아니라 pod의 backend의 IP주소를 준다.</p>
<p>어디에 쓰는지? 왜 쓰는지?
분산형 데이터 저장 서비스(DB, Messeage Queue, InMemory DB)</p>
<ol>
<li>클라이언트 연결</li>
<li>몇 개가 살아있는지 확인하기 위해서</li>
<li><strong>특정 노드의 데이터를 확인해야할 때 -&gt; 이게 핵심</strong></li>
</ol>
<p>분산형 데이터베이스 (Cassandra, Mongo, Redis)에 저장이 될 때 데이터를 저장하기 위해서는 Hash Algorithm을 쓴다. 이 때 노드에 저장을 하기 위해서는 노드의 정보를 알야아하는데 어를 때 노드의 정보를 반환하기 위해서 Headless를 이용한다.</p>
<ul>
<li>Hash Algorithm을 사용할 때 Node의 갯수가 약 10 이상의 소수인 경우에 even하게 값이 분산이 되는 것을 확인할 수 있다.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="volume">volume<a href="https://indianapoly.github.io/en/blog/2025/07/15/kubernetes/kubernetes-basic-1-title#volume" class="hash-link" aria-label="Direct link to volume" title="Direct link to volume">​</a></h3>
<p>docker image layer에 hash 값이 있는 이유는 ?</p>
<p>가상 머신의 디스크를 쓰게 된다면, 하나만 수정해도 전체가 변경이 된다. 이 때 docker 의 layer를 생각을 하면 캐시를 할 수 있다는 점이다. 따라서 변경이 되면 해시 값이 바뀜으로 인해서 변경 사항을 파악 가능하다.</p>
<p>컨테이너가 종료된다면? 다 사라짐.
-&gt; 컨테이너가 종료되어도 데이터를 유지할 수 있는 방법은 외부 디스크 볼륨을 마운트 하는 것입니다.</p>
<ul>
<li>
<p>EmptyDir: Pod가 종료되면 영구적으로 삭제됩니다. (즉 Pod와 동일한 LifeCycle을 가지게 됩니다.) --&gt; 그런데 왜 쓸까요? 대규모 기반 정렬 작업, Pod 내의 컨테이너 간 파일 교환을 하기 위함이에요.</p>
</li>
<li>
<p>HostPath: pod가 종료되어도 상태가 유지가 됩니다. 다만 Pod는 항상 다른 노드로 이동 가능성이 존재하기 때문에 에러가 날 수 있다는 문제가 있습니다.</p>
</li>
<li>
<p>persistent volume(PV)</p>
<ul>
<li>block disk (노트북 c drive) : 동시에 읽을 수는 있지만, 쓸 수 없습니다. | 순서가 제일 빠릅니다.</li>
<li>network file disk(systme) = NFS : 여러 사용자가 접근하여 동시에 쓸 수 있고, 읽을 수 있습니다. | 2순위</li>
<li>object dist (aws S3) : 3순위 =&gt; 대규모 작업은 여기서 진행을 합니다. 왜 그럴까요? Append only, 파일을 열어서 수정할 수 없습니다. =&gt; 왜 그럴까요? 분산 작업에 유리하기 때문입니다. (연산 중에 변경을 하면 처음부터 다시 해야하는데, 이런 작업을 애초에 닫아버립니다.)</li>
</ul>
</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="실습">실습<a href="https://indianapoly.github.io/en/blog/2025/07/15/kubernetes/kubernetes-basic-1-title#%EC%8B%A4%EC%8A%B5" class="hash-link" aria-label="Direct link to 실습" title="Direct link to 실습">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-httpd-배포--이미지-업데이트--롤백--삭제">1. HTTPD 배포 → 이미지 업데이트 → 롤백 → 삭제<a href="https://indianapoly.github.io/en/blog/2025/07/15/kubernetes/kubernetes-basic-1-title#1-httpd-%EB%B0%B0%ED%8F%AC--%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8--%EB%A1%A4%EB%B0%B1--%EC%82%AD%EC%A0%9C" class="hash-link" aria-label="Direct link to 1. HTTPD 배포 → 이미지 업데이트 → 롤백 → 삭제" title="Direct link to 1. HTTPD 배포 → 이미지 업데이트 → 롤백 → 삭제">​</a></h3>
<p>아래 파일 통해서 httpd를 설치한다.</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> httpd</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> httpd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> httpd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> httpd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> httpd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> httpd</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2.4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><br></span></code></pre></div></div>
<p><strong>1. Deployment</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f ./deploy-practice.yml</span><br></span></code></pre></div></div>
<ul>
<li>httpd-deployment 라는 이름의 deployment가 생성이 된다.</li>
<li>POD는 기본 설정에 따라서 적용이 된다.</li>
</ul>
<p><strong>2. 변경 사유(Revision 1) 주석(Annotation) 추가</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl annotate deploy httpd-deployment kubernetes.io/change-cause="first"</span><br></span></code></pre></div></div>
<ul>
<li>기록에 "first"라는 설명을 추가한다.</li>
<li>rollout history 에 Revision 1로 기록이 된다.</li>
</ul>
<p><strong>3. 이미지 업데이트 및 변경 사유 등록 (Revision 2)</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl set image deploy httpd-deployment httpd=httpd:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl annotate deploy httpd-deployment kubernetes.io/change-cause="update latest"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ul>
<li>httpd 컨터이너의 이미지가 httpd<!-- -->:latest<!-- -->로 업데이트가 된다.</li>
<li>update latest 로 주석 추가가 된다.</li>
</ul>
<p><strong>4. 롤아웃 상태 확인 및 파드 확인</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl rollout status deploy httpd-deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods -l app=httpd</span><br></span></code></pre></div></div>
<ul>
<li>파드가 정상적으로 배포가 된다.</li>
</ul>
<p><strong>5. Scale out</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl scale deploy httpd-deployment --replicas=5</span><br></span></code></pre></div></div>
<ul>
<li>레플리카 수가 5개로 증가가 된다. 기존에서 2개 추가가 된다.</li>
</ul>
<p><strong>6. Rollback</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl rollout undo deploy httpd-deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl annotate deploy httpd-deployment kubernetes.io/change-cause="rollback"</span><br></span></code></pre></div></div>
<ul>
<li>이전 비전으로 롤백이 진행이 된다.</li>
<li>롤백 사유는 rollback으로 기록</li>
</ul>]]></content:encoded>
            <category>TIL</category>
            <category>Kubernetes</category>
        </item>
        <item>
            <title><![CDATA[Docker Basic(1)]]></title>
            <link>https://indianapoly.github.io/en/blog/2025/07/14/docker/docker-basic-1-title</link>
            <guid>https://indianapoly.github.io/en/blog/2025/07/14/docker/docker-basic-1-title</guid>
            <pubDate>Mon, 14 Jul 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[{/ truncate /}]]></description>
            <content:encoded><![CDATA[
<p>cloudwave 6기 수업에서 들은 내용을 정리한 글입니다.</p>
<blockquote>
<p><a href="https://docs.docker.com/manuals/" target="_blank" rel="noopener noreferrer">Docker DOCS</a></p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="docker를-사용하는-이유">Docker를 사용하는 이유<a href="https://indianapoly.github.io/en/blog/2025/07/14/docker/docker-basic-1-title#docker%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0" class="hash-link" aria-label="Direct link to Docker를 사용하는 이유" title="Direct link to Docker를 사용하는 이유">​</a></h3>
<p>도커를 활용하는 이유는 크게 보면 서비스의 추상화입니다. HOST 환경과 서비스를 격리 시킴으로서</p>
<ol>
<li>
<p>서비스를 편하게 사용할 수 있습니다.</p>
</li>
<li>
<p>격자의 역할로 이들을 조립하여 새로운 결과물을 만들 수 있습니다.</p>
</li>
</ol>
<p>이와 같은 이점이 있어 도커를 사용합니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="dockerfile">Dockerfile<a href="https://indianapoly.github.io/en/blog/2025/07/14/docker/docker-basic-1-title#dockerfile" class="hash-link" aria-label="Direct link to Dockerfile" title="Direct link to Dockerfile">​</a></h3>
<div class="language-Dockerfile language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># BASE_IMAGE에 @를 활용한 tag를 지정하지 않으면 latest를 사용합니다.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># FROM은 기본적으로 한 번만 사용이 되는데 2번 이상 사용에 대해서는 아래에서 설명을 하겠습니다.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM BASE_IMAGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 컨테이너 내의 working directory를 변경합니다.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR &lt;경로&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 포트를 외부로 노출을 합니다.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPOSE &lt;포트번호&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ADD의 경우에는 github과 같은 RemotePath가 가능합니다.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 넣고자 하는 파일: 상대 경로</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 컨테이너 내 경로 : 절대 경로 사용</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ADD &lt;넣고자하는 파일의 경로&gt; &lt;컨테이너 내 경로&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY &lt;넣고자하는 파일의 경로&gt; &lt;컨테이너 내 경로&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 이미지를 빌드하는 과정에 명령어를 실행</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN &lt;명령어&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># CMD 같은 경우에는 docker run시 변경이 가능하지만 ENTRYPOINT는 변경이 불가능하다.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMD &lt;명령어 정의&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENTRYPOINT &lt;필수 실행 명령어&gt;</span><br></span></code></pre></div></div>
<ul>
<li>
<p>이미지에서는 tag와 digest를 사용할 수 있습니다. tag의 경우에는 시점에 따라서 이미지가 상이할 수 있습니다. 하지만 digest는 완전히 고정이 되어있습니다.</p>
</li>
<li>
<p>통용되진 않지만 <strong>ARG와 같은 명령어를 제외</strong>한다면 한줄의 도커 파일 명령어 한 줄마다 레이어가 되며, 레이어드르인 기본적으로 Read Only 상태를 가지게 됩니다.</p>
<blockquote>
<p>ARG 값을 Application 내부에서 사용을 하지 않기 때문에 굳이 Layer로 만들 필요가 없습니다.</p>
</blockquote>
</li>
<li>
<p>레이어의 최상단에는 <strong>container layer</strong>가 존재하는데 해당 레이어는 Read Write 상태를 가지게 됩니다. 컨테이너가 삭제가 된다면 container layer 역시 삭제가 됩니다.</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="dockerfile-이미지-생성">Dockerfile 이미지 생성<a href="https://indianapoly.github.io/en/blog/2025/07/14/docker/docker-basic-1-title#dockerfile-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%83%9D%EC%84%B1" class="hash-link" aria-label="Direct link to Dockerfile 이미지 생성" title="Direct link to Dockerfile 이미지 생성">​</a></h3>
<blockquote>
<p>docker build 시에 -f 로 Dockerfile을 지정해주지 않으면 기본적으론 Dockerfile을 사용합니다.</p>
</blockquote>
<p>Dockerfile의 목적은 이미지를 만드는 것입니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="multi-stage">Multi Stage<a href="https://indianapoly.github.io/en/blog/2025/07/14/docker/docker-basic-1-title#multi-stage" class="hash-link" aria-label="Direct link to Multi Stage" title="Direct link to Multi Stage">​</a></h3>
<p>아래 예시는 golang을 image를 활용하여 Go application을 컴파일을 진행합니다. 그리고 위의 결과물을 Scratch 이미지로 가져와 Scratch를 실행합니다.</p>
<div class="language-Dockerfile language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM golang:1.19-alpine as build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR /app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY src ./</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN CGO_ENABLED=0 go build -o main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM scratch as release</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=build /app/main /app/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR /app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMD ["/app/main"]</span><br></span></code></pre></div></div>
<p>첫 번째로 사용된 FROM은 임시로 쓰이고 버려집니다. --from을 활용해서 첫 번째 FROM의 결과물을 넣을 수 있습니다. 이렇게 실행을 하게되면 alpine보다 scratch 이미지의 크기가 작다는 이점이 존재합니다.</p>
<p>Production 환경에서는 보안성 증대 및 이미지 경량화를 위해 사용하는 경우가 많이 있습니다.</p>]]></content:encoded>
            <category>TIL</category>
            <category>Docker</category>
        </item>
        <item>
            <title><![CDATA[Docker Basic(2)]]></title>
            <link>https://indianapoly.github.io/en/blog/2025/07/10/docker/docker-basic-2-title</link>
            <guid>https://indianapoly.github.io/en/blog/2025/07/10/docker/docker-basic-2-title</guid>
            <pubDate>Thu, 10 Jul 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[{/ truncate /}]]></description>
            <content:encoded><![CDATA[
<p>cloudwave 6기 수업에서 들은 내용을 정리한 글입니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="docker-network">Docker Network<a href="https://indianapoly.github.io/en/blog/2025/07/10/docker/docker-basic-2-title#docker-network" class="hash-link" aria-label="Direct link to Docker Network" title="Direct link to Docker Network">​</a></h3>
<p>네트워크를 사용하는 이유는 Data 송수신 및 접근 제어를 하기 위함입니다.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker network create [OPTIONS] NETWORK</span><br></span></code></pre></div></div>
<p>주요 옵션에는 --driver(-d), --label이 있습니다.</p>
<p>--driver의 종류</p>
<ul>
<li>bridge : 동일한 host 컴퓨터 내에서 컨테이너끼리 통신하기 위해서 사용을 합니다</li>
<li>host : 컨테이너가 host와 동일한 네트워크를 사용합니다. (인스턴스 별로 한개만 생성)</li>
<li>none</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker network connect [OPTIONS] NETWORK CONTAINER</span><br></span></code></pre></div></div>
<p>주요 옵션에는 --alias, --ip가 있습니다.
--alias는 네트워크 alias를 추가하는 것으로 일종의 추상화입니다.</p>
<p>네트워크 연결을 제거하기 위해서는 <code>disconnect</code>를 쓰고, 삭제를 하기 위해서는 <code>rm</code>을 사용합니다. 모든 네트워크를 삭제하기 위해서는 <code>prune</code>을 사용합니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="buildx">buildx<a href="https://indianapoly.github.io/en/blog/2025/07/10/docker/docker-basic-2-title#buildx" class="hash-link" aria-label="Direct link to buildx" title="Direct link to buildx">​</a></h3>
<p>동일한 기능에 다른 아키텍처를 빌드하기 위해서 사용합니다.</p>
<p><strong>Multi-platform용 builder 생성</strong></p>
<p>플랫폼 옵션을 통해서 이미지를 빌드할 수 있는 빌더를 생성할 수 있습니다.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker buildx create --driver docker-container --name multi-builder --platform linux/amd64,linux/arm64</span><br></span></code></pre></div></div>
<p><strong>이미지 빌드하기</strong></p>
<p>플랫폼 옵션을 활용하여 각 아키텍처에 맞는 이미지를 제작할 수 있습니다.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker buildx build --platform linux/amd64,linux/arm64 -t &lt;이름태그 설정&gt; .</span><br></span></code></pre></div></div>]]></content:encoded>
            <category>TIL</category>
            <category>Docker</category>
        </item>
    </channel>
</rss>